<%- contentFor('extra_css') %>

<%- contentFor('content') %>

<div class="container-xxl mt-4">
  <form method="POST" enctype="multipart/form-data">
    <!-- Hidden field for publish status -->
    <input type="hidden" id="isPublished" name="visible" value="false">
    
    <!-- Basic Information -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="name" class="form-label">Name <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="name" name="name" placeholder="e.g. My Amazing Service Post" required oninput="generateSlugAndMetaTitle()">
      </div>
      <div class="col-md-6">
        <label for="slug" class="form-label">Slug</label>
        <input type="text" class="form-control" id="slug" name="slug" placeholder="service-slug (auto-generated)" >
      </div>
      <!-- Featured Image -->
       <div class="col-md-6">
        <label for="featuredImage" class="form-label">Featured Image</label>
        <input type="file" class="form-control" id="featuredImage" name="image" accept="image/*">
      </div>  
    </div>

    <!-- Content -->
    <div class="row mb-3">
      <div class="col-12">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" name="description" placeholder="Write your blog description here..."></textarea>
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-12">
        <label for="content" class="form-label">Content <span class="text-danger">*</span></label>
        <textarea class="form-control" id="content" name="content" placeholder="Write your blog content here..."></textarea>
      </div>
    </div>
    <h5 class="mt-4">SEO Metadata</h5>

    <div class="row mb-3">
      <div class="col-md-6">
        <label for="metaTitle" class="form-label">Meta Title</label>
        <input type="text" class="form-control" id="metaTitle" name="metaTitle" placeholder="SEO title for search engines">
        <small class="form-text text-muted">Leave empty to use main title</small>
      </div>
      <div class="col-md-6">
        <label for="metaDescription" class="form-label">Meta Description</label>
        <textarea class="form-control" id="metaDescription" name="metaDescription" rows="2" placeholder="SEO description for search engines"></textarea>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label for="metaKeywords" class="form-label">Meta Keywords</label>
        <input type="text" class="form-control" id="metaKeywords" name="metaKeywords" placeholder="SEO keywords (comma-separated)">
      </div>
      <div class="col-md-6">
        <label for="canonicalUrl" class="form-label">Canonical URL</label>
        <input type="text" class="form-control" id="canonicalUrl" name="canonicalUrl" placeholder="https://example.com/canonical-url">
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="publishDate" class="form-label">Publish Date</label>
        <input type="date" class="form-control" id="publishDate" name="publishDate">
      </div>
    </div>


    <div class="row">
      <div class="col-12">
        <button type="submit" class="btn btn-success me-2" onclick="setPublishStatus(true)">
          <i class="fas fa-paper-plane"></i> Publish
        </button>
        <button type="submit" class="btn btn-secondary me-2" onclick="setPublishStatus(false)">
          <i class="fas fa-save"></i> Save as Draft
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="window.history.back()">Cancel</button>
      </div>
    </div>
  </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ckeditor5/39.0.1/ckeditor.min.js"></script>
<script>
  let editor;

  // Initialize CKEditor
  ClassicEditor
    .create(document.querySelector('#content'), {
      toolbar: {
        items: [
          'heading', '|',
          'bold', 'italic', 'underline', 'strikethrough', '|',
          'link', 'bulletedList', 'numberedList', '|',
          'outdent', 'indent', '|',
          'imageUpload', 'blockQuote', 'insertTable', '|',
          'undo', 'redo', '|',
          'alignment', 'fontColor', 'fontBackgroundColor', '|',
          'code', 'codeBlock', '|',
          'sourceEditing'
        ]
      },
      language: 'en',
      image: {
        toolbar: [
          'imageTextAlternative',
          'imageStyle:inline',
          'imageStyle:block',
          'imageStyle:side',
          'linkImage'
        ]
      },
      table: {
        contentToolbar: [
          'tableColumn',
          'tableRow',
          'mergeTableCells'
        ]
      }
    })
    .then(editorInstance => {
      editor = editorInstance;
      
      // Sync CKEditor content with form on submit
      document.querySelector('form').addEventListener('submit', function(e) {
        const content = editor.getData();
        document.querySelector('#content').value = content;
        
        // Custom validation for CKEditor content
        if (!content.trim()) {
          e.preventDefault();
          alert('Content is required. Please write some content for your blog post.');
          editor.focus();
          return false;
        }
      });
    })
    .catch(error => {
      console.error('Error initializing CKEditor:', error);
    });

  function setPublishStatus(isPublished) {
    document.getElementById('isPublished').value = isPublished;
  }

  function generateSlugAndMetaTitle() {
    const title = document.getElementById('name').value;
    document.getElementById('metaTitle').value = title;
    const slug = title.toLowerCase()
                      .trim()
                      .replace(/[^a-z0-9]+/g, '-')
                      .replace(/^-+|-+$/g, '');
    
    document.getElementById('slug').value = slug;
  }

</script>

<%- contentFor('extra_javascript') %>